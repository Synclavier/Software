// ===========================================================================//	PrefUtils.c// ===========================================================================////  Handy class for accessing prefs file from C or C++//  Std C Includes#include <String.h>//	Mac OS Includes#include <Files.h>#include <Folders.h>#include <Strings.h>//	Local includes#include "PrefUtils.h"// -----------------------------------------------------// PU_LocatePrefsFile// -----------------------------------------------------OSErr PU_LocatePrefsFile(char *prefs_name, struct FSSpec *the_spec){	short		foundVRefNum;							// VRefNum of Preferences folder	long		foundDirID;								// DirID of Preferences folder	OSErr		err;	char		pas_name[64];		strncpy(pas_name, prefs_name, sizeof(pas_name));	c2pstr (pas_name);	err = FindFolder(kOnSystemDisk, kPreferencesFolderType, kDontCreateFolder, &foundVRefNum, &foundDirID);	if (!err)											// make FSSpec		err = FSMakeFSSpec(foundVRefNum, foundDirID, (ConstStr255Param) pas_name, the_spec);			return (err);}// -----------------------------------------------------// read_interchange_setup:  Reads in settings from prefs file.  Initializes settings// to default values if no file exists or can't read it.// -----------------------------------------------------OSErr PU_ReadPrefsFile(struct FSSpec *the_spec, void* the_data, long data_size){	OSErr		err     = noErr;	short		refNum  = 0;									// prefs ref num	long		length  = data_size;		memset(the_data, 0, data_size);								// prevent bogus return values	err = FSpOpenDF(the_spec, fsRdPerm, &refNum);		if (!err)													// read data	{		err = FSRead(refNum, &length, the_data);				if (err)			FSClose(refNum);		else			FSClose(refNum);	}		return (err);}// -----------------------------------------------------// Write config: writes settings to prefs file, thereby freeing up// allocated memory.// -----------------------------------------------------OSErr PU_WritePrefsFile(struct FSSpec *the_spec, void* the_data, long data_size, OSType creator, OSType type){		short		refNum = 0;										// prefs ref num	OSErr		err    = noErr;									// file system error	long		length = data_size;								// used for FSWrite		err = FSpOpenDF(the_spec,fsWrPerm,&refNum);					// open the file's data fork		if (err)	{		err = FSpCreate(the_spec, creator, type, 0);			// create file		if (!err)												// if we could create the file 			err = FSpOpenDF(the_spec,fsWrPerm,&refNum);			// open the file's data fork	}	if (!err)													// if we could get the file open	{		err = SetFPos(refNum, fsFromStart, 0);				if (!err)		{			length = data_size;			err    = FSWrite(refNum, &length, the_data);		}				FSClose(refNum);										// close the file	}		return (err);}