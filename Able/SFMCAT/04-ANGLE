/* 04-ANGLE  $TITLE  Sine and Cosine Table Lookup Procedure *//* Copyright 1985 by New England Digital Corporation */dcl sintable.len                       lit '256';dcl intpol.len                         lit '64';dcl sintable.(sintable.len+intpol.len) fixed;dcl sintable                           lit 'addr(sintable.(0))';dcl (sine,cosine) fixed; /* global variables to return sin and cos */angle:proc(theta); /* returns signed sine and cosine * 32768 */   /* the interpolating sines (times two )(theta=0 to 63/65536) are       read from table; this is probably unnecessary since they may be      approximated by 2*pi*theta */   dcl theta              fixed; /* 0<=theta<65536(=2*pi) */      dcl w                  lit 'cosine';       dcl iw                 lit 'sine';   dcl intp               fixed;    dcl (bit8,bit9)        fixed;   dcl (temp,temp2,temp3) fixed;   intp=theta&63; /* separate fractions and bits from input */   theta=shr(theta,6); /* 0 to 1023 */   bit8=((theta&256)<>0);   bit9=((theta&512)<>0);   theta=theta&255;   if bit8 then do;      iw=core(sintable+sintable.len-theta);      w =core(sintable+theta);   end;   else do;          iw=core(sintable+theta);      w =core(sintable+sintable.len-theta);   end;   if bit9          then iw=(-iw);   if bit8 xor bit9 then w =(-w);   if intp<>0 then do; /* interpolate between table values */      /*  if W = cos(theta) + i sin(theta), then          W(theta+delta)=W(theta)*W(delta)           if delta<63, then cos(delta) is approximately 1 */      temp=core(sintable+sintable.len+intp+1); /* sin(intp) */      write(5)=temp;      write(6)=iw;      temp2=read(4);      if iw<0 then temp2=temp2-temp;      temp2=w-temp2;      if (temp2&"100000")<>(w&"100000") then do; /* overflow check */         if      w>0 then temp2=  32767;         else if w<0 then temp2=(-32767);      end;            write(5)=temp;      write(6)=w;      temp3=read(4);      if w<0 then temp3=temp3-temp;      temp3=iw+temp3;      if (temp3&"100000")<>(iw&"100000") then do;         if      iw>0 then temp3=32767;         else if iw<0 then temp3=-32767;      end;      iw=temp3;      w=temp2;   end;end angle;