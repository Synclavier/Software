/* Copyright 1982 by New England Digital Corporation *//* 32 bit integer fourier synthesis (complex to real) *//* IFSST synthesizes a real 32 bit block floating point vector, with the most significant bits in array bmsb(i) and the least significantbits in array blsb(i), i=0 to n-1, for n=2**m, from Fourier coefficients     stored in the bmsb,blsb arrays of size N+2.The DC term should be in locations bmsb(0),blsb(0), with bmsb(1)=blsb(1)=0.the Jth harmonic should be stored in locations   ( bmsb(2*j),  blsb(2*j)   ) .                                             +i*( bmsb(2*j+1),blsb(2*j+1) )The n/2 harmonic should be in locations bmsb(n),blsb(n)with bmsb(n+1)=blsb(n+1)=0.*/dcl double1 lit 'omsb=shl(omsb,1);';dcl double2 lit 'if olsb<0 then omsb=omsb\1;';    dcl double3 lit 'olsb=shl(olsb,1);';dcl double  lit 'double1;double2;double3';    ifsst:proc(bmsb,blsb,n) fixed;       /* fsst=1 is an error return, if n is not a power of 2  */  dcl bmsb fixed array;  dcl blsb fixed array;  dcl n fixed;               /* n must be a power of 2 */  /* constant declarations */  dcl m.max lit '15';        /* max power of two */  dcl p7 lit '23170';        /* int(32768*0.70710678) */  /* variable declarations */  dcl (i,m,nr,n4pow,n2pow,nn,int,it) fixed;  dcl (tmsb,tlsb) fixed;  fr4syn:proc;    dcl (j,k,ji,jl,jr,j1,j2,j3,j4,j5,j6,j7,j8,j9,j10,j11,j12,j13,j14,jthet) fixed;    dcl (k1,k2,k3) fixed;    dcl (k0,kl,jlast,int4,j0) fixed;    dcl th2 fixed;    dcl (t0msb,t0lsb) fixed;    dcl (t1msb,t1lsb) fixed;    dcl (t2msb,t2lsb) fixed;    dcl (t3msb,t3lsb) fixed;    dcl (t4msb,t4lsb) fixed;    dcl (t5msb,t5lsb) fixed;    dcl (t6msb,t6lsb) fixed;    dcl (t7msb,t7lsb) fixed;    dcl (r1msb,r1lsb) fixed;    dcl (r5msb,r5lsb) fixed;    dcl (prmsb,prlsb) fixed;    dcl (pimsb,pilsb) fixed;    dcl (c1,s1,c2,s2,c3,s3) fixed;    dcl k4 lit 'k';    dcl k5 lit 'k1';    dcl k6 lit 'k2';    dcl k7 lit 'k3';    dcl (jj1,jj2,jj3) fixed;    dcl l(15) fixed;    dcl l0 lit 'l(m.max-0)';    dcl l1 lit 'l(m.max-1)';    dcl l2 lit 'l(m.max-2)';    dcl l3 lit 'l(m.max-3)';    dcl l4 lit 'l(m.max-4)';    dcl l5 lit 'l(m.max-5)';    dcl l6 lit 'l(m.max-6)';    dcl l7 lit 'l(m.max-7)';    dcl l8 lit 'l(m.max-8)';    dcl l9 lit 'l(m.max-9)';    dcl l10 lit 'l(m.max-10)';    dcl l11 lit 'l(m.max-11)';    dcl l12 lit 'l(m.max-12)';    dcl l13 lit 'l(m.max-13)';    dcl l14 lit 'l(m.max-14)';    dcl l15 lit 'l(m.max-15)';    /* jthet is a reversed binary counter, jr steps two at a time    to locate th real parts of intermediate results, and ji locates    the imaginary part corresponding to jr. */             rescale=rescale+2; /* each pass divides input by     4 */    l(0)= nn/4;   /* our counter is indexed from location zero */    do k=1 to m.max-1;      if l(k-1)-2 < 0 then do;        l(k-1)=2;        l(k)=2;      end;        else do;        l(k)=2;        if l(k-1)-2 > 0 then l(k)=l(k-1)/2;      end;      end;    ji=3;     jl=2;    jr=2;    do j1=2 to l1 by 2;      do j2=j1 to l2 by l1;        do j3=j2 to l3 by l2;           do j4=j3 to l4 by l3;            do j5=j4 to l5 by l4;              do j6=j5 to l6 by l5;                do j7=j6 to l7 by l6;                  do j8=j7 to l8 by l7;                    do j9=j8 to l9 by l8;                      do j10=j9 to l10 by l9;                        do j11=j10 to l11 by l10;                          do j12=j11 to l12 by l11;                            do j13=j12 to l13 by l12;                              do j14=j13 to l14 by l13;                                do jthet=j14 to l15 by l14;      /* -1 since B is based on zero */                                           if jthet igt 2 then do;                                    write(5)=jthet-2;                                    write(6)=32768;                                    th2=read(5);                                    write(7)=nn;                                    th2=read(5);                                    call angle(th2);                                    c1=cosine;s1=-sine;                                    call angle(shl(th2,1));                                    c2=cosine;s2=-sine;                                    write(5)=th2;                                    write(6)=3;                                    th2=read(5);                                    call angle(th2);                                    c3=cosine;s3=-sine;                                    int4=int*4;                                    j0=jr*int4; /* -1 from FORTRAN */                                    k0=ji*int4; /* -1 from FORTRAN */                                    jlast=j0+int-1;                                    do j=j0 to jlast;                                      k=k0+j-j0;                                      k5=k+int;                                      k6=k5+int;                                      k7=k6+int;                                      jj1=j+int;                                      jj2=jj1+int;                                      jj3=jj2+int;                                                                            begin; /* b(j)=b(j)/2 */                                        dcl omsb lit 'bmsb(j)';                                         dcl olsb lit 'blsb(j)';                                        half;                                      end;                                      begin; /* b(jj1)=b(jj1)/2 */                                         dcl omsb lit 'bmsb(jj1)';                                        dcl olsb lit 'blsb(jj1)';                                        half;                                      end;                                      begin; /* b(jj2)=b(jj2)/2 */                                        dcl omsb lit 'bmsb(jj2)';                                        dcl olsb lit 'blsb(jj2)';                                        half;                                      end;                                      begin; /* b(jj3) =b(jj3)/2 */                                        dcl omsb lit 'bmsb(jj3)';                                        dcl olsb lit 'blsb(jj3)';                                        half;                                      end;                                      begin; /* b(k4)=b(k4)/2 */                                        dcl omsb lit 'bmsb(k4)';                                        dcl olsb lit 'blsb(k4)';                                        half;                                      end;                                      begin; /* b(k5)=b(k5)/2 */                                        dcl omsb lit 'bmsb(k5)';                                        dcl olsb lit 'blsb(k5)';                                        half;                                      end;                                      begin; /* b(k6)=b(k6)/2 */                                        dcl omsb lit 'bmsb(k6)';                                        dcl olsb lit 'blsb(k6)';                                        half                                      end;                                      begin; /* b(k7)=b(k7)/2 */                                        dcl omsb lit 'bmsb(k7)';                                        dcl olsb lit 'blsb(k7)';                                        half;                                      end;                                      begin; /* t0 = b(j)  +  b(k6) */                                        dcl omsb lit 't0msb';                                          dcl olsb lit 't0lsb';                                            dcl imsb1 lit 'bmsb(j)';                                        dcl ilsb1 lit 'blsb(j)';                                        dcl imsb2 lit 'bmsb(k6)';                                        dcl ilsb2 lit 'blsb(k6)';                                        add;                                        half;                                      end;                                      begin; /* t1 = b(k7) -  b(jj1) */                                        dcl omsb lit 't1msb';                                        dcl olsb lit 't1lsb';                                        dcl imsb1 lit 'bmsb(k7)';                                        dcl ilsb1 lit 'blsb(k7)';                                        dcl imsb2 lit 'bmsb(jj1)';                                        dcl ilsb2 lit 'blsb(jj1)';                                        subtract;                                        half;                                      end;                                      begin; /* t2 = b(j)  -  b(k6) */                                        dcl omsb lit 't2msb';                                        dcl olsb lit 't2lsb';                                        dcl imsb1 lit 'bmsb(j)';                                        dcl ilsb1 lit 'blsb(j)';                                        dcl imsb2 lit 'bmsb(k6)';                                        dcl ilsb2 lit 'blsb(k6)';                                        subtract;                                        half;                                      end;                                        begin; /* t3 = b(k7) +  b(jj1) */                                        dcl omsb lit 't3msb';                                        dcl olsb lit 't3lsb';                                        dcl imsb1 lit 'bmsb(k7)';                                        dcl ilsb1 lit 'blsb(k7)';                                        dcl imsb2 lit 'bmsb(jj1)';                                        dcl ilsb2 lit 'blsb(jj1)';                                        add;                                        half;                                      end;                                        begin; /* t4 = b(jj2)+  b(k4) */                                         dcl omsb lit 't4msb';                                         dcl olsb lit 't4lsb';                                         dcl imsb1 lit 'bmsb(jj2)';                                         dcl ilsb1 lit 'blsb(jj2)';                                         dcl imsb2 lit 'bmsb(k4)';                                         dcl ilsb2 lit 'blsb(k4)';                                         add;                                         half;                                      end;                                      begin; /* t5 = b(k5) -  b(jj3) */                                        dcl omsb lit 't5msb';                                        dcl olsb lit 't5lsb';                                        dcl imsb1 lit 'bmsb(k5)';                                        dcl ilsb1 lit 'blsb(k5)';                                        dcl imsb2 lit 'bmsb(jj3)';                                        dcl ilsb2 lit 'blsb(jj3)';                                        subtract;                                        half;                                      end;                                      begin; /* t6 = b(k5) +  b(jj3) */                                        dcl omsb lit 't6msb';                                        dcl olsb lit 't6lsb';                                        dcl imsb1 lit 'bmsb(k5)';                                        dcl ilsb1 lit 'blsb(k5)';                                        dcl imsb2 lit 'bmsb(jj3)';                                        dcl ilsb2 lit 'blsb(jj3)';                                        add;                                        half;                                      end;                                      begin; /* t7 = b(k4) -  b(jj2) */                                        dcl omsb lit 't7msb';                                        dcl olsb lit 't7lsb';                                        dcl imsb1 lit 'bmsb(k4)';                                        dcl ilsb1 lit 'blsb(k4)';                                        dcl imsb2 lit 'bmsb(jj2)';                                        dcl ilsb2 lit 'blsb(jj2)';                                        subtract;                                        half;                                      end;                                      begin; /* b(j) = t0 + t4 */                                        dcl omsb lit 'bmsb(j)';                                        dcl olsb lit 'blsb(j)';                                        dcl imsb1 lit 't0msb';                                        dcl ilsb1 lit 't0lsb';                                        dcl imsb2 lit 't4msb';                                        dcl ilsb2 lit 't4lsb';                                        add;                                      end;                                      begin; /* b(k4)= t1 + t5 */                                        dcl omsb lit 'bmsb(k4)';                                        dcl olsb lit 'blsb(k4)';                                        dcl imsb1 lit 't1msb';                                        dcl ilsb1 lit 't1lsb';                                        dcl imsb2 lit 't5msb';                                        dcl ilsb2 lit 't5lsb';                                        add;                                      end;/* now do adds */                                                                            begin; /* r1=t2+t6 */                                        dcl omsb lit 'r1msb';                                        dcl olsb lit 'r1lsb';                                        dcl imsb1 lit 't2msb';                                        dcl ilsb1 lit 't2lsb';                                        dcl imsb2 lit 't6msb';                                        dcl ilsb2 lit 't6lsb';                                        add;                                      end;                                      begin; /* r5=t2-t6 */                                         dcl omsb lit 'r5msb';                                        dcl olsb lit 'r5lsb';                                        dcl imsb1 lit 't2msb';                                        dcl ilsb1 lit 't2lsb';                                        dcl imsb2 lit 't6msb';                                        dcl ilsb2 lit 't6lsb';                                        subtract;                                      end;                                      begin; /* t2=t0-t4 */                                        dcl omsb lit 't2msb';                                        dcl olsb lit 't2lsb';                                        dcl imsb1 lit 't0msb';                                        dcl ilsb1 lit 't0lsb';                                        dcl imsb2 lit 't4msb';                                        dcl ilsb2 lit 't4lsb';                                        subtract;                                      end;                                      begin; /* t6=t3+t7 */                                        dcl omsb lit 't6msb';                                        dcl olsb lit 't6lsb';                                        dcl imsb1 lit 't3msb';                                        dcl ilsb1 lit 't3lsb';                                        dcl imsb2 lit 't7msb';                                        dcl ilsb2 lit 't7lsb';                                        add;                                      end;                                      begin; /* t0=t1-t5 */                                        dcl omsb lit 't0msb';                                        dcl olsb lit 't0lsb';                                        dcl imsb1 lit 't1msb';                                        dcl ilsb1 lit 't1lsb';                                        dcl imsb2 lit 't5msb';                                        dcl ilsb2 lit 't5lsb';                                        subtract;                                      end;                                      begin; /* t4=t3-t7 */                                        dcl omsb lit 't4msb';                                        dcl olsb lit 't4lsb';                                        dcl imsb1 lit 't3msb';                                        dcl ilsb1 lit 't3lsb';                                        dcl imsb2 lit 't7msb';                                        dcl ilsb2 lit 't7lsb';                                        subtract;                                      end;                                                                            begin; /*  b(jj1) = (t2 + t6)*c1 - (t3 + t7)*s1 */                                        dcl w lit 'c1';                                        dcl iw lit '(-s1)';                                        dcl omsb lit 'bmsb(jj1)';                                        dcl olsb lit 'blsb(jj1)';                                        dcl imsb1 lit 'r1msb';                                        dcl ilsb1 lit 'r1lsb';                                        dcl imsb2 lit 't6msb';                                        dcl ilsb2 lit 't6lsb';                                        multiply;                                        double;                                      end;                                        begin; /* b(k5)  = (t2 + t6)*s1 + (t3 + t7)*c1 */                                        dcl w lit 's1';                                        dcl iw lit 'c1';                                        dcl omsb lit 'bmsb(k5)';                                        dcl olsb lit 'blsb(k5)';                                        dcl imsb1 lit 'r1msb';                                        dcl ilsb1 lit 'r1lsb';                                        dcl imsb2 lit 't6msb';                                        dcl ilsb2 lit 't6lsb';                                        multiply;                                        double;                                      end;                                      begin; /* b(jj2) = (t0 - t4)*c2 - (t1 - t5)*s2 */                                        dcl w lit 'c2';                                        dcl iw lit '(-s2)';                                        dcl omsb lit 'bmsb(jj2)';                                        dcl olsb lit 'blsb(jj2)';                                        dcl imsb1 lit 't2msb';                                        dcl ilsb1 lit 't2lsb';                                        dcl imsb2 lit 't0msb';                                        dcl ilsb2 lit 't0lsb';                                        multiply;                                        double;                                      end;                                      begin; /* b(k6)  = (t0 - t4)*s2 + (t1 - t5)*c2 */                                        dcl w lit 's2';                                        dcl iw lit 'c2';                                        dcl omsb lit 'bmsb(k6)';                                        dcl olsb lit 'blsb(k6)';                                        dcl imsb1 lit 't2msb';                                        dcl ilsb1 lit 't2lsb';                                        dcl imsb2 lit 't0msb';                                        dcl ilsb2 lit 't0lsb';                                        multiply;                                        double;                                      end;                                      begin; /* b(jj3) = (t2 - t6)*c3 - (t3 - t7)*s3 */                                        dcl w lit 'c3';                                        dcl iw lit '(-s3)';                                        dcl omsb lit 'bmsb(jj3)';                                        dcl olsb lit 'blsb(jj3)';                                        dcl imsb1 lit 'r5msb';                                        dcl ilsb1 lit 'r5lsb';                                        dcl imsb2 lit 't4msb';                                        dcl ilsb2 lit 't4lsb';                                        multiply;                                        double;                                      end;                                      begin; /* b(k7)  = (t2 - t6)*s3 + (t3 - t7)*c3 */                                        dcl w lit 's3';                                        dcl iw lit 'c3';                                        dcl omsb lit 'bmsb(k7)';                                        dcl olsb lit 'blsb(k7)';                                        dcl imsb1 lit 'r5msb';                                        dcl ilsb1 lit 'r5lsb';                                        dcl imsb2 lit 't4msb';                                        dcl ilsb2 lit 't4lsb';                                        multiply;                                        double;                                      end;                                    end;                                    jr=jr+2;                                    ji=ji-2;                                    if (ji-jl)<=0 then do;                                      ji=2*jr-1;                                      jl=jr;                                    end;                                  end;                                  else do;                                    do k=0 to int-1;                                      k1=k+int;                                      k2=k1+int;                                      k3=k2+int;                                                                            begin; /* b(k)=b(k)/2 */                                        dcl omsb lit 'bmsb(k)';                                        dcl olsb lit 'blsb(k)';                                        half;                                      end;                                      begin; /* b(k1)=b(k1)/2 */                                        dcl omsb lit 'bmsb(k1)';                                        dcl olsb lit 'blsb(k1)';                                        half;                                      end;                                      begin; /* t0 = b(k) + b(k1) */                                        dcl omsb lit 't0msb';                                        dcl olsb lit 't0lsb';                                        dcl imsb1 lit 'bmsb(k)';                                        dcl ilsb1 lit 'blsb(k)';                                        dcl imsb2 lit 'bmsb(k1)';                                        dcl ilsb2 lit 'blsb(k1)';                                        add;                                        half;                                      end;                                      begin; /* t1 = b(k) - b(k1) */                                        dcl omsb lit 't1msb';                                        dcl olsb lit 't1lsb';                                        dcl imsb1 lit 'bmsb(k)';                                        dcl ilsb1 lit 'blsb(k)';                                        dcl imsb2 lit 'bmsb(k1)';                                        dcl ilsb2 lit 'blsb(k1)';                                        subtract;                                        half;                                      end;                                      begin; /* t2 = b(k2)*2./4=b(k2)/2 */                                        dcl omsb lit 't2msb';                                        dcl olsb lit 't2lsb';                                        t2msb=bmsb(k2);                                        t2lsb=blsb(k2);                                        half;                                      end;                                      begin; /* t3 = b(k3)*2./4=b(k3)/2 */                                        dcl omsb lit 't3msb';                                        dcl olsb lit 't3lsb';                                        t3msb=bmsb(k3);                                        t3lsb=blsb(k3);                                        half;                                      end;                                      begin; /* b(k) = t0 + t2 */                                        dcl omsb lit 'bmsb(k)';                                        dcl olsb lit 'blsb(k)';                                        dcl imsb1 lit 't0msb';                                        dcl ilsb1 lit 't0lsb';                                        dcl imsb2 lit 't2msb';                                        dcl ilsb2 lit 't2lsb';                                        add;                                      end;                                      begin; /* b(k2)= t0 - t2 */                                        dcl omsb lit 'bmsb(k2)';                                        dcl olsb lit 'blsb(k2)';                                        dcl imsb1 lit 't0msb';                                        dcl ilsb1 lit 't0lsb';                                        dcl imsb2 lit 't2msb';                                        dcl ilsb2 lit 't2lsb';                                        subtract;                                      end;                                      begin; /* b(k1)= t1 + t3 */                                        dcl omsb lit 'bmsb(k1)';                                        dcl olsb lit 'blsb(k1)';                                        dcl imsb1 lit 't1msb';                                        dcl ilsb1 lit 't1lsb';                                        dcl imsb2 lit 't3msb';                                        dcl ilsb2 lit 't3lsb';                                        add;                                      end;                                      begin; /* b(k3)= t1 - t3 */                                        dcl omsb lit 'bmsb(k3)';                                        dcl olsb lit 'blsb(k3)';                                        dcl imsb1 lit 't1msb';                                        dcl ilsb1 lit 't1lsb';                                        dcl imsb2 lit 't3msb';                                        dcl ilsb2 lit 't3lsb';                                        subtract;                                      end;                                    end;                                      if nn-4>0 then do;                                      k0=int*4;  /* Fortran -1 */                                      kl=k0+int-1;                                      do k=k0 to kl;                                        k1=k+int;                                        k2=k1+int;                                        k3=k2+int;                                        begin; /* b(k)=b(k)/2 */                                          dcl omsb lit 'bmsb(k)';                                          dcl olsb lit 'blsb(k)';                                          half;                                        end;                                        begin; /* b(k1)=b(k1)/2 */                                          dcl omsb lit 'bmsb(k1)';                                          dcl olsb lit 'blsb(k1)';                                          half;                                        end;                                          begin; /* b(k2)=b(k2)/2 */                                          dcl omsb lit 'bmsb(k2)';                                          dcl olsb lit 'blsb(k2)';                                          half;                                        end;                                          begin; /* b(k3) =b(k3)/2 */                                          dcl omsb lit 'bmsb(k3)';                                          dcl olsb lit 'blsb(k3)';                                          half;                                        end;                                                                                  begin; /* t2 = b(k)  - b(k2) */                                          dcl omsb lit 't2msb';                                          dcl olsb lit 't2lsb';                                          dcl imsb1 lit 'bmsb(k)';                                          dcl ilsb1 lit 'blsb(k)';                                          dcl imsb2 lit 'bmsb(k2)';                                          dcl ilsb2 lit 'blsb(k2)';                                          subtract;                                        end;                                        begin; /* t3 = b(k1) + b(k3) */                                          dcl omsb lit 't3msb';                                          dcl olsb lit 't3lsb';                                          dcl imsb1 lit 'bmsb(k1)';                                          dcl ilsb1 lit 'blsb(k1)';                                          dcl imsb2 lit 'bmsb(k3)';                                          dcl ilsb2 lit 'blsb(k3)';                                          add;                                        end;                                                                                  begin; /* b(k)  = (b(k)  + b(k2))*2./2 */                                          dcl omsb lit 'bmsb(k)';                                          dcl olsb lit 'blsb(k)';                                          dcl imsb1 lit 'bmsb(k2)';                                          dcl ilsb1 lit 'blsb(k2)';                                          dcl imsb2 lit 'bmsb(k)';                                          dcl ilsb2 lit 'blsb(k)';                                          add;                                        end;                                        begin; /* b(k2) = (b(k3) - b(k1))*2./2 */                                          dcl omsb lit 'bmsb(k2)';                                          dcl olsb lit 'blsb(k2)';                                          dcl imsb1 lit 'bmsb(k3)';                                          dcl ilsb1 lit 'blsb(k3)';                                          dcl imsb2 lit 'bmsb(k1)';                                          dcl ilsb2 lit 'blsb(k1)';                                          subtract;                                        end;                                        begin; /* b(k1) = (t2 + t3)*p7two/2 */                                                dcl w lit 'p7';                                           dcl iw lit 'p7';                                           dcl omsb lit 'bmsb(k1)';                                           dcl olsb lit 'blsb(k1)';                                           dcl imsb1 lit 't2msb';                                           dcl ilsb1 lit 't2lsb';                                           dcl imsb2 lit 't3msb';                                           dcl ilsb2 lit 't3lsb';                                           multiply;                                           double;                                        end;                                        begin; /* b(k3) = (t3 - t2)*p7two */                                          dcl w lit 'p7';                                          dcl iw lit '(-p7)';                                           dcl omsb lit 'bmsb(k3)';                                              dcl olsb lit 'blsb(k3)';                                          dcl imsb1 lit 't3msb';                                          dcl ilsb1 lit 't3lsb';                                          dcl imsb2 lit 't2msb';                                          dcl ilsb2 lit 't2lsb';                                          multiply;                                          double;                                        end;                                      end;                                      end;                                  end;                                  end;                                end;                              end;                            end;                          end;                        end;                      end;                    end;                  end;                end;              end;            end;          end;        end;      end;      return;  end fr4syn;    m=compute.m(n);  if m=0 then return 1;    /* n not a power of 2 */  bmsb(1)=bmsb(n);  blsb(1)=blsb(n);  i=3;bmsb(i)=bmsb(i);blsb(i)=blsb(i);   do i=3 to n-1 by 2;    bmsb(i)=-bmsb(i);    if blsb(i)^=0 then bmsb(i)=bmsb(i)-1;    blsb(i)=-blsb(i);  end;    /* scramble the inputs */  call iford2(m,bmsb);  call iford2(m,blsb);  call iford1(m,bmsb);  call iford1(m,blsb);  /* scale the input by n */  rescale=rescale-m;  n4pow=m/2;  if (n4pow)^=0 then do;    nn=n;            /* note: the algorithm has been slightly changed from the IEEE version */     do it=1 to n4pow;      int=n/nn;      call fr4syn;      nn=nn/4;    end;    end;  if (m-n4pow*2)>0 then do;    int=n/2;    call ifr2tr(int,bmsb,blsb);  end;  return 0;end ifsst;