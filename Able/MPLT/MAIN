/* $d $f $title Main Declarations and Driver *//* Synclavier Music Printing System   Alan D. Talbot - New England Digital Corp.   Main Driver Routine - Compile This File */insert ':mplt:lits';dcl REVISION       fixed data public ('G.3'),	/* Oops, Alan sez there was already a revision G.2 */    SCRIPT_RELEASE fixed data public ('M - 5.3'),    RELEASE_DATE   fixed data public ('2015/01/01');library ':MPLT:RELOC:GLOBRTNS';library ':MPLT:RELOC:SYNCRTNS';library ':MPLT:RELOC:PICSRTNS';library ':MPLT:RELOC:PSPKRTNS';library ':MPLT:RELOC:HARDRTNS';library ':MPLT:RELOC:MENURTNS';library ':MPLT:RELOC:MAINRTNS';library ':MPLT:RELOC:LISTRTNS';library ':MPLT:RELOC:PLOTRTNS';library ':MPLT:RELOC:EDITRTNS';abort.scsi:procedure public; end; 	/* This may go away (into -xpl:scsiswap) */insert ':-xpl:scsiswap'; 			/* Library of SCSI stuff and SCSI lits */insert ':-xpl:asciidef'; 			/* This will soon go away because XPL will have "pointer" etc. *//* Procedures */dcl MAIN_DRIVER procedure (boolean) external;/* External Memory Pointers */dcl EDIT_BASE            fixed public,    XMEM_BASE            fixed public,    ALIB_BASE            fixed public,    ULIB_BASE            fixed public,    SLIB_BASE            fixed public,    FLIB_BASE            fixed public,    FLIB_LEN             fixed public,    PFIL_BASE            fixed public,    OVLY_BASE            fixed public,    LAST_SECT            fixed public,    FREESEG_HEAD         fixed public;/* Sequence xmem sector pointers and sector lengths */dcl BAS.PTR              fixed public,    BAS.LEN              fixed public,    PAR.PTR              fixed public,    PAR.LEN              fixed public,    NAH.PTR              fixed public,    NAH.LEN              fixed public,    INF.PTR              fixed public,    INF.LEN              fixed public,    SEQ.LENGTH           fixed public;/* Core Pointers */dcl CORE_ORIGIN          pointer public,    CORE_BASE            pointer public,    BUFF_BASE            pointer public,    MAIN_BASE            pointer public,    BANK_BASE            pointer public,    TEXT_BASE            pointer public,    PART_BASE            pointer public,    NAME_BASE            pointer public,    HOLD_MAIN_BASE       pointer public,    HOLD_PART_BASE       pointer public,    PLOT_MAIN_BASE       pointer public,    PLOT_PART_BASE       pointer public,    EDIT_MAIN_BASE       pointer public;/* General list pointers */dcl    FREE_HEAD      pointer public,       FREE_TAIL      pointer public;/* Pointers into the voice list */dcl    VOX_HEAD       pointer public,       VOX_TAIL       pointer public;/* Pointers into the note heap */dcl    HEAP_HEAD      pointer public;/* Pointers into the chord lists */dcl    OLD_HEAD       pointer public,       NEW_HEAD       pointer public;/* Sequence values (i.e. from "bas" (misc) area) */dcl MUS_MAG              fixed public,    CLICK_RATE           fixed public;/* Globals for communication between sequence handlers */dcl (#TRK)            FIXED PUBLIC, /* ABS TRK NUMBER ACTION IS TO TAKE PLACE ON */    (#PTR)            FIXED PUBLIC, /* ABS PTR TO TRACK HEAD */    /* NOTE: ORDER OF #NMSB - #ANYR MUST MATCH TRACK HEAD */    (#NMSB,#NLSB)     FIXED PUBLIC, /* NEXT TIME CORRESPONDING TO PTR */    (#LMSB,#LLSB)     FIXED PUBLIC, /* LAST TIME CORRESPONDING TO PTR */    (#WRD,#SEC)       FIXED PUBLIC, /* RELATIVE PTR INTO NAH AREA AT WHICH ACTION OCCURS */    (#ANYF,#ANYR)     FIXED PUBLIC, /* ANY REV & FOR FOR THIS POINT   */    (#W1,#W2,#W3,#W4) FIXED PUBLIC, /* 4 WORDS TO HOLD A NOTE RECORD */    (#MSB,#LSB)       FIXED PUBLIC, /* GENERAL 32-BIT VALUE TO PASS OR RETURN */     #STATUS          fixed public; /* Status of track (UNINIT#,VALID#,ACTIVE#,OUT#) *//* Overall preset information */dcl START_MEAS           fixed public,    INIT_MEAS            fixed public,    LAST_MEAS            fixed public,    INIT_PAGE            fixed public,    PRINTER_TYPE         fixed public,    PRINTER_WIDTH        fixed public,    PIXEL_WIDTH          fixed public,    PIXEL_LENGTH         fixed public,    LEFT_MARGIN          fixed public,    PAGE_WIDTH           fixed public,    BOT_MARGIN           fixed public,    PAGE_LENGTH          fixed public,    SCALE_FACTOR         fixed public,    OVERLAP              fixed public,    FIRST_INDENT         fixed public,    SPACING_PERCENT      fixed public,    MEAS_FREQ            fixed public,    MEAS_SYNC            fixed public,    MEAS_LINE            fixed public,    START_CLICK          fixed public,    CLICK_NOTE           fixed public,    CLICK_TRACK          fixed public,    EDIT_RESOLUTION      fixed public,    FORMAT               fixed public,    NOTE_SPACE           fixed public,    BAR_SPACE            fixed public,    STVS_PP              fixed public,    SIDES                fixed public,    STAVES               fixed public,    PARTS                fixed public,    LISTS                fixed public,    BANK                 fixed public,/*  CHARSET              fixed public, */    EDIT_MODE            fixed public,    TSIZE                fixed public,    BOXTX                boolean public,    AUTO_CENTER          boolean public;/*  AUX_FONT             boolean public; *//* Overall Spec Values */dcl BEAT_MEAS            fixed public,    BEAT_NOTE            fixed public,    MEASURE_NUMBER       fixed public,    MEASURE_VALUE        fixed public,    EDIT_POSITION        fixed public,    MEDIT_INDEX          fixed public,    MEDIT_POINT          pointer public,    MEDIT_END            pointer public,    POSN_PTR             pointer public,    NOTE_PTR             pointer public;/* Special Global Values (Pathalogical communication) */dcl SIDE                 fixed public,    STAFF                fixed public,    PART                 fixed public,    VOICE                fixed public,    SYSTEM               fixed public,    START_STAFF(63)      fixed public, /* These could be moved to xmem */    STOP_STAFF(63)       fixed public,    REPLOT_MEASURE       fixed public,    PAGE_CNT             fixed public,    CURRENT_FONT         fixed public,    FROM_PAGE            fixed public,    TO_PAGE              fixed public,    EDIT_FONT            fixed public,    EXTENDED             boolean public,    LIBRARY              boolean public,    UPPER_FONT           fixed public,    LOWER_FONT           fixed public,    WINDOW_XL            fixed public,    WINDOW_XH            fixed public,    WINDOW_YL            fixed public,    WINDOW_YH            fixed public,    SEQUENCE_NAME(32)    fixed public,    OVERLAY_FILE(32)     fixed public,    SLUR_GRAIN           floating public,    NUMBERED_SEQUENCE    boolean public,    NEW_SEQUENCE         boolean public,    RESET_EDITOR         boolean public,    MASTER_RECORD        boolean public;/* Score format preset information */dcl STAFF_SPACE(MAX_PARTS-1) fixed public,    LIST_INDEX(MAX_PARTS)    fixed public,    BUFF_LIST                fixed public;/* Part Spec Values */dcl PBITS                fixed public,    TRACK(1)             fixed public,    RESOLUTION(1)        fixed public,    TRANSPOSE(1)         fixed public,    HEAD_TYPE(1)         fixed public,    CLEF                 fixed public,    KEY                  fixed public,    SPLIT                fixed public,    MEASNO_POS           fixed public,   /* 8 bit X, 8 bit Y */    MEASNO_FORMAT        fixed public,   /* NA, 8 bit format */    PLOTBITS             fixed public,    EDIT_INDEX           fixed public,    EDIT_POINT           pointer public,    EDIT_END             pointer public,    TWO_VOICE            boolean public,    ONE_TRACK            boolean public,    TABLATURE            boolean public;/* List and sequence pointers */dcl HEAD(MAX_PARTS-1)        pointer public,    LAST(MAX_PARTS-1)        pointer public,    TAIL(MAX_PARTS-1)        pointer public,    HOLD_HEAD(MAX_PARTS-1)   pointer public;/*  SEQ_POINT(MAX_PARTS*2-1) pointer public; *//* Pointers into the position list */dcl POS_HEAD             pointer public,    POS_LINE             pointer public,    POS_LAST             pointer public,    POS_TAIL             pointer public,    HOLD_POS_HEAD        pointer public;/* Miscellaneous */dcl DISPLAY(MAX_PARTS-1)   fixed public,    TEMPO                  fixed public,    STORAGE_DEVICE         fixed public,    STARTUP_ARG            fixed public,    SCREEN_WIDTH#          fixed public, /* Remove # someday? */    EDIT_SCREEN_LENGTH#    fixed public,    EDIT_TOP#              fixed public,    EDIT_BOT#              fixed public,    SCAN_SIZE#             fixed public,    SCREEN_LENGTH#         fixed public,    DISPLAY_SCREEN_LENGTH# fixed public,    SCREEN_TOP#            fixed public,    SCREEN_BOT#            fixed public,    WIN_TOP#               fixed public,    WIN_BOT#               fixed public,    LOWER_TOP#             fixed public,    RUNNING              boolean public,    ENGRAVING            boolean public,    END_OF_PAGE          boolean public,    ERROR_CHECK          boolean public,    CATCH_PS_ERRORS      boolean public,    PS_ERROR_PRESENT     boolean public,    MG600                boolean public,    GO250                boolean public,    MACII                boolean public;/* Memory management pointers and counters */dcl PDS_BASE             pointer public,    MAIN_SPEC_BASE       pointer public,    PART_SPEC_BASE       pointer public,    EDIT_STAK_BASE       pointer public,    STORAGE              pointer public,    NEXT_WORD            pointer public,    ERR_PTR              pointer public;/* Buffers */dcl BUFF(256)            fixed public,    WIDTH_TABLE(512)     fixed public, /* Set length in LITS also */    REC(10)              fixed public; /* Should really be 8 *//* Debug stuff */dcl TIME_XOFFED(1)       fixed public,    CLOCK(1)             fixed public;/* Key signature accidental position tables */dcl SHARP_TABLE       fixed data public (0,L5,S3,S5,L4,S2,S4,L3),    FLAT_TABLE        fixed data public (0,L3,S4,S2,L4,L2,S3,S1),    TENOR_SHARP_TABLE fixed data public (0,L2,L4,S2,S4,L3,L5,S3);/* Clef tables */dcl CLEF_NAMES fixed data public ("H47","H41","H54","H46","H50","H53","H42"),    CLEF_TABLE fixed data public (0,18,24,36,0,0,0),    CLEF_MODS  fixed data public (0,-3,+3,-6,0,0,0);/* Key tables */dcl KEY_NAMES   fixed data public       ('C G D A E B F#C#G#D#A#E#B#F BfEfAfDfGfCfFfc g d a e b f#c#g#d#a#e#b#f bfefafdfgfcfff'),    KEY_CODES   fixed data public       (0,0,1,2,3,4,5,6,7,-4,-3,-2,-1,0,-1,-2,-3,-4,-5,-6,-7,4, /* Majors */        -3,-2,-1,0,1,2,3,4,5,6,7,-4,-3,-4,-5,-6,-7,4,3,2,1),    /* Minors */    TRANS_TABLE fixed data public ( 1,-6,-1, 4,-3, 2, 7, 0, 5,-2, 3,-4, 1,-6,-1),    KEYIN_TABLE fixed data public ( 1, 6,15, 4,17, 2, 7,14, 5,16, 3,18);/* Preset tables */dcl MAIN_DEFAULTS fixed data public  /* Main preset defaults (24 for F.2 and up) */  (102,  "H0100","H0104","H0404",      0,"H6905",      0,"H0010",      1,        1,      0,"H0200","H0064","H0764","H0064","H0A00","H0101",  "H1400",      0,"H0400",      0,      0,      0,      0,      0,  /* System keypad defaults */  "H0501","H7F48","H0402","H0709","H1A18","H0308","H1B19","H0624",  "H5250","H2220","H0A51","H2321","H3A3C","H4239","H3B3D","H4338",  "H6A68","HC266","H6E69","HC367","H90D0","H9495","H91D2","H9C96",  /* User keypad defaults */        0,      0,      0,      0,      0,      0,      0,      0,        0,      0,      0,      0,      0,      0,      0,      0,        0,      0,      0,      0,      0,      0,      0,      0,  /* Auxilliary keypad defaults */        0,      0,      0,      0,      0,      0,      0,      0,        0,      0,      0,      0,      0,      0,      0,      0,        0,      0,      0,      0,      0,      0,      0,      0,  /* Empty titles */        0,      0,      0,      0,  /* Empty overlay file name */        0);dcl PART_DEFAULTS fixed data public  (11,"H0001","H1010","H0000",0,"H001A","H0001",0,P_PLOT,0,0);/* Errors */dcl ERR_PLAY    fixed data public ('Unable to play sequence'),    ERR_REVERSE fixed data public ('Unable to reverse compile sequence'),    ERR_PRINT   fixed data public ('Unable to print sequence'),    ERR_SEQNA   fixed data public ('Sequence not available on this disk'),    ERR_CNVNA   fixed data public ('Reverse Compiler not accessible'),    ERR_INC     fixed data public ('Incompatible sequence'),    ERR_IMP     fixed data public ('Sequence contains incompatible music printing data'),    ERR_BIGSEQ  fixed data public ('Sequence too big for external memory'),    ERR_LONGSEQ fixed data public ('Sequence too long to store'),    ERR_NOSPRO  fixed data public ('System file .SPRO-7 is missing'),    ERR_BADARG  fixed data public ('Illegal PLOT argument (-P or -E only)'),    ERR_NOPARTS fixed data public ('No parts selected for printing'),    ERR_STAVES  fixed data public ('Too many staves at once'),    ERR_NOD40   fixed data public ('D40 printer interface card not present'),    ERR_INCPRI  fixed data public ('Printer incompatable for Music Printing'),    ERR_NOROOM  fixed data public ('Program out of room');/* Miscellaneous arrays */dcl KEYPAD_ON       fixed data public (2,"H3D1B"), /* Puts auxiliary keypad in functions mode */    KEYPAD_OFF      fixed data public (2,"H3E1B"), /* Puts auxiliary keypad in ascii mode */    ALTERNATE_CHARS fixed data public (3,"H281B","H0030"), /* Invoke special graphics character set */    NORMAL_CHARS    fixed data public (3,"H281B","H0042"), /* Invoke standard ascii character set */    DOUBLE_WIDE     fixed data public (3,"H231B","H0036"), /* Make current line double width */    DOUBLE_HEIGHT_T fixed data public (3,"H231B","H0033"), /* Make current line double width */    DOUBLE_HEIGHT_B fixed data public (3,"H231B","H0034"), /* Make current line double width */    CLEAR_CUR       fixed data public (4,"H5B1B","H4A30"), /* Clear screen from cursor position *//*    CHECKERBOARD    fixed data public (7,"H281B","H6130","H281B","H0042"),    VBAR            fixed data public (7,"H281B","H7830","H281B","H0042"),    UPPERL          fixed data public (7,"H281B","H6C30","H281B","H0042"),    LOWERL          fixed data public (7,"H281B","H6D30","H281B","H0042"),    TOPT            fixed data public (7,"H281B","H7730","H281B","H0042"),*/    SPACE_5         fixed data public ('     ');call MAIN_DRIVER (false);