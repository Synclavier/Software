PrintWinchesterState: proc(State);   dcl State fixed;   do case State;      pstring('Init Drive      ');      pstring('Winchester Disk ');   end;end PrintWinchesterState;WinchesterMenu: proc;end WinchesterMenu;ProcessWinchester: proc(D24,Target) returns (fixed); /* process Winchester states */   dcl D24      fixed; /* D24 address of drive */   dcl Target   fixed; /* SCSI Target ID of drive */   dcl State    fixed; /* new state */   dcl done     boolean; /* TRUE if done processing states */   dcl Sense    fixed; /* SCSI sense key */   dcl DriveHdl handle; /* handle to drive record */   dcl DrivePtr pointer; /* pointer to drive record */   dcl delay    fixed; /* amount of time to delay next command */   /* Winchester Disk States */   dcl InitDrive       lit '0';   dcl SystemDrive     lit '1';   /* main procedure */   DriveHdl = GetDriveHandle(D24,Target); /* get handle to drive record */   if DriveHdl = Null then do; /* no drive handle, so create it */      DriveHdl = Alloc_Handle(d#DriveRecLen); /* allocate space */      if DriveHdl = Null then return(60);      dev(GetDeviceIndex(D24,Target) + v$DriveHandle) = DriveHdl; /* store drive handle */      State = InitDrive; /* initialize stuff */   end;   else do; /* use current drive record */      State = core(core(DriveHdl) + d$State); /* get current state */   end;   delay = 10; /* default delay */   done = false; /* not done yet */   do while not done;      do case State; /* process the states */         do; /* Init Drive */            call InitDriveRec(D24,Target); /* initialize record */            DrivePtr = core(DriveHdl); /* get pointer to drive record */            core(DrivePtr + d$MS_FirstTime) = MS_Seconds; /* store time drive was found */            core(DrivePtr + d$LS_FirstTime) = LS_Seconds;            core(DrivePtr + d$DevType) = S$DirectAccess; /* this is direct access */            State = SystemDrive; /* this must be a system disk */         end;         do; /* System Drive */            delay = 60;            done = true;         end;      end; /* case states */   end; /* while not done */   DrivePtr = core(DriveHdl); /* get pointer to drive record */   core(DrivePtr + d$PrevState) = core(DrivePtr + d$State); /* save previous state */   core(DrivePtr + d$State) = State; /* store new state */   return (delay);end ProcessWinchester;