/* 412-D42   $TITLE  D42 (Modem Port) DEC TALK routine   Modified:   11/12/87 - MWH - Make timer comparisons unsigned to fix "30 sec hang"   */#if (inc.voice.output)	do.voice.output:proc public swapable;       /* handle output */	   dcl (i,j,k)   fixed;		   call enable_d42;                         /* enable inter  */		   if new.upper<>0 then i= 0;               /* start at top  */	   else                 i=16;               /* else lower    */	   if new.lower<>0 then j=32;               /* finish lower  */	   else                 j=16;               /* else top only */		   do k=0 to 31;                            /* restore earlier  */		  if wimage(k)=0 then wimage(k)=32;     /* deleted spaces   */	   end;                                     /* in case random   */		   k=32;                                    /* delete trailing  */	   do while (k>16)&(wimage(k-1)=32);        /* spaces so        */		  k=k-1;                                /* dec-talk works   */		  wimage(k)=0;                          /* better           */		  if (k=16)&(j=32) then j=16;           /* no lower         */	   end;                                     /* if empty display */		   k=16;	   do while (k>0)&(wimage(k-1)=32);		  k=k-1;		  wimage(k)=0;		  if (k=0)&(i=0) then j=16;             /* no upper         */	   end;		   do while i<j;                            /* write out first info  */		  if wimage(i)<0 then call d42pc(46);   /* leading decimal pt    */		  if wimage(i)<>0                       /* print if not trailer  */		  then call d42pc(wimage(i)&255);       /* print character       */		  i=i+1;                                /* advance pointer       */		  if ((i=16)&(both.display=0))          /* end of first line     */		  or ((i=j))                            /* or end of second line */		  then do;			 if i=j then do;                    /* send index reply last */				call d42pc(027); call d42pc(080);   /* see dec talk      */				call d42pc(048); call d42pc(059);   /* programmers       */				call d42pc(050); call d42pc(049);   /* manual p 40       */				call d42pc(059); call d42pc(048);				call d42pc(122); call d42pc(027);				call d42pc(092);			 end;			 call d42pc(44); call d42pc(13); call d42pc(10); /* use comma */			 if i=j then call d42pc(10);        /* extra lf at end       */		  end;		  else if (i=16)&(both.display<>0)      /* end of first line of  */		  then do;                              /* of two line display   */			 if  (wimage(16)<>0 )               /* if next line begins   */			 and (wimage(16)<>32)               /* with non-space        */			 then call d42pc(32);               /* then add space here   */		  end;	   end;		   new.upper=0;	   new.lower=0;		   d42.output.happening=1;                  /* slow down output      */	   speak.time=real.milliseconds;            /* every 2 seconds       */		end do.voice.output;#endif